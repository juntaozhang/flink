apiVersion: v1
kind: Pod
metadata:
  name: socket-server
  labels:
    app: socket-server
spec:
  containers:
    - name: netcat
      image: busybox:latest # 每次client连接端口后，server会自动重启
      command: ['nc']
      args: ['-lk', '-p', '19998']
      ports:
        - containerPort: 19998

---
apiVersion: v1
kind: Pod
metadata:
  name: socket-server
  labels:
    app: socket-server
spec:
  restartPolicy: Never
  containers:
    - name: netcat
      image: chainguard/netcat:latest
      command: ['sleep']
      args: ['infinity']
      ports:
        - containerPort: 19998

# kubectl expose pod socket-server --port=19998 --target-port=19998 --name=socket-server --selector="app=socket-server" --type=LoadBalancer
# k run c1 busybox --image=busybox --rm --restart=Never -it -- sh
